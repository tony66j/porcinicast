<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trova Porcini</title>
  <link rel="preconnect" href="https://unpkg.com">
  <link rel="preconnect" href="https://tile.openstreetmap.org">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin="" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin="" defer></script>

  <style>
    :root{
      --bg:#0b0f13; --card:#121821; --accent:#3fb950; --muted:#9aa7b0; --text:#e5eef5; --grid-w:1440px;
    }
    html,body{height:100%;}
    body{margin:0; background:var(--bg); color:var(--text); font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;}
    header{max-width:var(--grid-w); margin:0 auto; padding:18px 20px 6px;}
    h1{font-size:1.35rem; margin:0 0 4px;}
    .byline{color:var(--muted); font-size:.9rem;}
    .wrap{max-width:var(--grid-w); margin:0 auto; padding:20px; display:grid; grid-template-columns:1.3fr 1fr; gap:18px;}
    .card{background:var(--card); border-radius:16px; padding:14px; box-shadow:0 6px 24px rgba(0,0,0,.25);}
    .row{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    input[type=text]{flex:1; min-width:280px; background:#0b0f13; color:var(--text); border:1px solid #223042; border-radius:12px; padding:10px 12px;}
    button{background:var(--accent); color:#08130a; border:0; border-radius:12px; padding:10px 14px; font-weight:700; cursor:pointer;}
    button:disabled{opacity:.6; cursor:not-allowed;}
    .muted{color:var(--muted); font-size:.9rem;}
    #map{height:480px; border-radius:14px; overflow:hidden;}
    .kpi{display:flex; gap:14px; align-items:baseline; flex-wrap:wrap; margin-top:6px;}
    .kpi .big{font-size:2.1rem; font-weight:800;}
    .badge{padding:6px 10px; border-radius:999px; font-weight:700; font-size:.9rem;}
    .badge.ok{background:#13361c; color:#9be495; border:1px solid #1d6d2f;}
    .badge.med{background:#2b2a00; color:#ffef8b; border:1px solid #6c6500;}
    .badge.low{background:#3a1111; color:#ffb5b5; border:1px solid #7d1f1f;}
    .section-title{margin-top:12px; font-weight:800;}
    .bar{display:grid; grid-template-columns:repeat(10,1fr); gap:6px; margin-top:10px;}
    .col{background:#0d141d; border:1px solid #223042; border-radius:10px; height:120px; position:relative; overflow:hidden;}
    .fill{position:absolute; bottom:0; left:0; width:100%; background:linear-gradient(180deg, #56f59d, #1a7f3b); }
    .label{position:absolute; top:6px; left:6px; right:6px; font-size:.78rem; color:var(--muted); text-align:center;}
    .scorelbl{position:absolute; bottom:6px; left:0; right:0; text-align:center; font-size:.85rem; font-weight:700;}
    .list{margin:8px 0 0 0; padding:0 0 0 16px; color:var(--muted);}
    .list li{margin:4px 0;}
    @media (max-width: 980px){ .wrap{grid-template-columns:1fr;} #map{height:360px;} }
  </style>
</head>
<body>
  <header>
    <h1>Trova Porcini</h1>
    <div class="byline">By Antonio Pio D’aloia</div>
    <div class="muted">Inserisci una località (es. “Abbadia San Salvatore”) oppure coordinate “lat, lon”.</div>
  </header>

  <div class="wrap">
    <div class="card">
      <div class="row" style="margin-bottom:10px;">
        <input id="q" type="text" placeholder="Es. 'Benevento' oppure '41.127, 14.782'">
        <button id="go">Cerca</button>
      </div>
      <div id="map" class="card"></div>
    </div>

    <div class="card" id="panel">
      <div class="row" style="justify-content:space-between;">
        <div>
          <div class="muted">Località</div>
          <div id="loc" style="font-weight:700;">—</div>
        </div>
        <div>
          <div class="muted">Affidabilità</div>
          <span id="rel" class="badge low">—</span>
        </div>
      </div>

      <div class="kpi">
        <div>
          <div class="muted">Indice oggi</div>
          <div id="score" class="big">—</div>
        </div>
        <div class="muted" id="models" title="Modelli usati"></div>
      </div>

      <div class="section-title">Previsione futura (10 giorni)</div>
      <div id="bars" class="bar"></div>

      <div class="section-title">Ultima pioggia</div>
      <div id="lastrain" class="muted">—</div>

      <div class="section-title">Fattori analizzati</div>
      <ul class="list" id="factors"></ul>

      <div id="hint" class="muted" style="margin-top:8px;"></div>
    </div>
  </div>

  <script>
    // Mappa
    let map, marker;
    function initMap(){
      map = L.map('map', {zoomControl: true}).setView([42.5, 12.5], 6);
      L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18, attribution: '&copy; OpenStreetMap'


